<app-loader [visible]="loading"></app-loader>

<div *ngIf="changeType" class="changes">

  <div [ngSwitch]="changeType">

    <div *ngSwitchCase="'new-character'">
      <app-character-modify type="NEW"></app-character-modify>
    </div>

    <div *ngSwitchCase="'story-for-char'" class="titles admin-panel admin-panel--main admin-panel-main">
      <div *ngIf="!areTitlesSet">
        <h2 class="changes__title changes__title">Wybierz tytuy do rozdzia贸w historii:</h2>
        <form class="story__form story-form" #storyForm="ngForm" id="storyForm"
          (ngSubmit)="generateStoryForms(storyForm)">
          <div class="story-form__container">
            <div class="story-form__container">
              Wybierz tytuy jakie chcesz doda:
              <div class="title-choice title-choice--for-char" *ngIf="titles">
                <label *ngFor="let title of titles" class="title-choice__item">
                  <input type="checkbox" ngModel [name]="title.id" />
                  {{title.title}}
                </label>
              </div>
              <div *ngIf="!titles" style="color: grey">
                Brak tytu贸w.
              </div>
            </div>
          </div>
          <input type="submit" class="global-button" value="Dalej" form="storyForm" />
        </form>
      </div>

      <div *ngIf="areTitlesSet">
        <h2 class="changes__title">Wypenij poni偶sze pola: </h2>
        <form class="titles__form titles-form" #titlesForm="ngForm" id="titlesForm"
          (ngSubmit)="createStory(titlesForm)">
          <label *ngFor="let title of titlesForStories | keyvalue" class="titles-form__item">
            {{title.value}}
            <textarea ngModel [name]="title.key" class="global-textarea titles-form__textarea"></textarea>
          </label>
          <input type="submit" class="global-button" value="Dodaj histori" form="titlesForm" />
        </form>
      </div>
    </div>

    <div *ngSwitchCase="'story'" class="story admin-panel admin-panel--main admin-panel-main">



      <div class="title-choice title-choice--edit">
        <form *ngIf="titles" #titlesSortForm="ngForm" id="titlesSortForm"
          (ngSubmit)="changeTitlesSequence(titlesSortForm)" class="title-choice__form">
          <input type="submit" class="global-button" value="Zapisz sekwencj tytu贸w" form="titlesSortForm" />
          <div *ngFor="let title of titles; index as i">
            <div class="titles__container">
              <div class="titles__options titles-options">
                <span class="option" title="Edytuj tytu">
                  <app-icon [icon]="'edit'" [color]="'whitesmoke'" [size]="'0.9'"></app-icon>
                </span>
                <span class="option" title="Usu tytu" (click)="insertDeleteInfo()" (dblclick)="deleteTitle(title.id)">
                  <app-icon [icon]="'archive'" [color]="'#b84343'"></app-icon>
                </span>
              </div>
              <div class="titles-to-edit">
                <div class="titles-to-edit__options">
                  <button class="global-button" (click)="changeSequence(titleSeq, 'UP')"></button>
                  <button class="global-button" (click)="changeSequence(titleSeq, 'DOWN')"></button>
                </div>
                <input type="number" #titleSeq readonly [id]="title.id" class="titles-to-edit__input" [ngModel]="i"
                  [name]="title.id" />
                {{title.title}}
              </div>
            </div>
          </div>

        </form>


        <form class="titles-form titles-form--new-title" [formGroup]="newTitleForm">
          <label class="titles-form__container global-label">
            Nowy tytu:
            <input class="global-input" type="text" formControlName="title" />
          </label>
          <button class="titles-form__button" (click)="createNewTitle()">
            +
          </button>
        </form>
      </div>
    </div>

    <div *ngSwitchCase="'quotes'" class="quotes admin-panel--main admin-panel-main">

      <div class="quotes__button-container">
        <button class="global-button quotes__button" (click)="showQuotesForm()" [disabled]="isQuoteFormShown">
          + Dodaj cytat
        </button>
      </div>

      <div *ngIf="isQuoteFormShown" class="quotes__container quotes__container--form">
        <form class="quotes__new-quote-form new-quote-form" [formGroup]="newQuoteForm">
          <h2 class="changes__title">Uzupenij poni偶sze pola, aby doda nowy cytat:</h2>

          <label class="changes__title quotes__label">
            Wpisz tre cytatu:
            <textarea class="global-textarea quotes__textarea" formControlName="quote"></textarea>
          </label>
          <label class="changes__title quotes__label" style="margin-top: 1rem;">
            Dodaj kontekst cytatu:
            <input type="text" class="global-input" formControlName="context" />
          </label>
          <button class="global-button quotes__button" [disabled]="newQuoteForm.invalid"
            (click)="createNewQuote()">Dodaj
            cytat</button>
        </form>
      </div>

      <div *ngIf="quotes?.length > 0" class="quotes__container quotes__container--quotes">
        <div *ngFor="let quote of quotes">
          <div class="quote" #quoteContainer>
            <div class="quote__options quote-options">
              <span class="option" title="Edytuj cytat"
                (click)="editQuote(quote.id, quoteEl, contextEl, quoteContainer)">
                <app-icon [icon]="'edit'" [color]="'whitesmoke'" [size]="'0.9'"></app-icon>
              </span>
              <span class="option" title="Usu cytat" (click)="insertDeleteInfo()" (dblclick)="deleteQuote(quote.id)">
                <app-icon [icon]="'archive'" [color]="'#b84343'"></app-icon>
              </span>
            </div>
            <q class="quote__quote" spellcheck="false" #quoteEl>{{quote.quote}}</q>
            <cite class="quote__context" spellcheck="false" #contextEl>{{quote.context}}</cite>
          </div>
        </div>
      </div>
      <div *ngIf="quotes?.length === 0" style="color: grey; margin-top: 1rem">
        Podana posta nie ma 偶adnych cytat贸w.
      </div>
    </div>

    <div *ngSwitchCase="'edit-character'">
      <app-character-modify type="EDIT" [charId]="selectedCharId"></app-character-modify>
    </div>

    <div *ngSwitchCase="'new-chars'" class="side-char admin-panel admin-panel--side">
      <h2 class="changes__title">Uzupenij poni偶sze pola, aby doda now posta poboczn:</h2>
      <form class="side-char__new-side-form new-side-form" [formGroup]="newSideCharForm"
        (ngSubmit)="createNewSideCharInfo()" enctype="multipart/form-data">
        <div class="new-side-form__container">
          <label class="global-label">
            Imi:
            <input type="text" class="global-input" formControlName="name" />
          </label>
          <label class="global-label">
            Nazwisko:
            <input type="text" class="global-input" formControlName="surname" />
          </label>
        </div>
        <label class="new-side-form__label global-label books" *ngIf="books">
          Wybierz szkicowniki, w kt贸rych posta wystpuje:
          <div *ngFor="let book of books">
            <input type="checkbox" class="global-input" [value]="book.externalId"
              (change)="onCheckChange($event, 'new-chars')" />
            <app-icon [icon]="'book'" [color]="book.color" [size]="0.8"></app-icon>
            {{book.name}}
          </div>
        </label>
        <label class="new-side-form__label global-label">
          <span style="margin-bottom: 5px">Zdjcie postaci:</span>
          <input #sideCharProfilePic class="global-file" formControlName="profilePic" type="file" accept="image/*" />
        </label>
        <div class="new-side-form__container new-side-form__container--story">
          <label class="new-side-form__label global-label"> Opis/historia postaci:
            <textarea class="global-textarea new-side-form__textarea" cols="50" formControlName="desc"></textarea>
          </label>
        </div>
        <input type="submit" class="global-button" [disabled]="newSideCharForm.invalid" />
      </form>
    </div>

    <div *ngSwitchCase="'edit-side'" class="edit-side-char admin-panel admin-panel--side">
      <ng-container *ngIf="sideCharacterDetails">
        <h2 class="changes__title">Edytuj poni偶sze pola: </h2>
        <form class="edit-side-char__edit-side-char-form edit-side-char-form" [formGroup]="editSideCharForm"
          (ngSubmit)="updateSideCharInfo()">
          <div class="edit-side-char-form__container">
            <label class="global-label">
              Imi:
              <input type="text" class="global-input" formControlName="name" />
            </label>
            <label class="global-label">
              Nazwisko:
              <input type="text" class="global-input" formControlName="surname" />
            </label>
          </div>
          <label class="edit-side-form__label global-label books" *ngIf="books">
            Wybierz szkicowniki, w kt贸rych posta wystpuje:
            <div *ngFor="let book of books">
              <input type="checkbox" class="global-input" [value]="book.externalId"
                (change)="onCheckChange($event, 'edit-chars')" [checked]="setBookValue(book.externalId)" />
              <app-icon [icon]="'book'" [color]="book.color" [size]="0.8"></app-icon>
              {{book.name}}
            </div>
          </label>
          <div class="edit-side-char-form__container edit-side-char-form__container--story">
            <label class="edit-side-char-form__label global-label"> Opis/historia postaci:
              <textarea class="global-textarea edit-side-char-form__textarea" cols="50"
                formControlName="desc"></textarea>
            </label>
          </div>
          <button class="global-button" [disabled]="editSideCharForm.invalid"
            (click)="updateSideCharInfo()">Zmie</button>
        </form>
      </ng-container>

    </div>

    <div *ngSwitchCase="'edit-side-pic'" class="edit-side-pic admin-panel admin-panel--side">
      <h2 class="changes__title">Zmie zdjcie profilowe postaci:</h2>
      <form class="edit-side-pic__edit-side-pic-form edit-side-pic-form" [formGroup]="newProfilePicForm"
        (ngSubmit)="setNewProfilePic()" enctype="multipart/form-data">
        <label class="edit-side-pic__label global-label">
          <span style="margin-bottom: 5px">Zdjcie pokazujce posta:</span>
          <input #newProfilePic class="global-file" formControlName="profilePic" type="file" accept="image/*" />
        </label>

        <button class="global-button" (click)="setNewProfilePic()">Zmie</button>
      </form>
    </div>
  </div>
</div>
